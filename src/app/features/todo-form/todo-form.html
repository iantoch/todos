<app-section-wrapper
  [title]="editMode() ? 'Edit Todo' : 'Create New Todo'"
  buttonType="back"
  (onClick)="handleRedirectBack()"
>
  <form [formGroup]="todoForm" (ngSubmit)="onSubmit()" class="todo-form">
    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Title</mat-label>
      <input matInput placeholder="Enter todo title" formControlName="title" />
      @if(titleControl?.errors?.['required'] && titleControl?.touched) {
      <mat-error>Title is required</mat-error>
      } @if(titleControl?.errors?.['minlength']) {
      <mat-error>Title must be at least 3 characters</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Description</mat-label>
      <textarea
        matInput
        placeholder="Enter todo description"
        formControlName="description"
        rows="3"
      ></textarea>
      @if(descriptionControl?.errors?.['required'] && descriptionControl?.touched) {
      <mat-error>Description is required</mat-error>
      } @if(descriptionControl?.errors?.['minlength']) {
      <mat-error>Description must be at least 10 characters</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" floatLabel="always">
      <mat-label>Due Date</mat-label>
      <input matInput [matDatepicker]="picker" [min]="minDate" formControlName="dueDate" />
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      @if(dueDateControl?.errors?.['required'] && dueDateControl?.touched) {
      <mat-error>Due date is required</mat-error>
      }
    </mat-form-field>

    <div class="form-actions">
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="!todoForm.valid || (editMode() && !todoForm.dirty)"
      >
        <mat-icon>{{ editMode() ? 'save' : 'add_task' }}</mat-icon>
        <span>{{ editMode() ? 'Update Todo' : 'Create Todo' }}</span>
      </button>

      <button mat-flat-button color="warn" type="button" (click)="handleRedirectBack()">
        <mat-icon>clear</mat-icon>
        <span>Cancel</span>
      </button>
    </div>
  </form>
</app-section-wrapper>
